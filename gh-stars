#!/usr/bin/env bash
set -euo pipefail

if [[ "${1:-}" == "--json" ]]; then
  gh api user/starred --paginate --jq '.[] | {name: .full_name, stars: .stargazers_count, language: .language, url: .html_url}'
  exit 0
fi

# Print header
printf "\033[1m%-40s %-8s %-15s %s\033[0m\n" "Repository" "Stars" "Language" "URL"
printf "%-40s %-8s %-15s %s\n" "----------" "-----" "---------" "-------------------"

# Safe row print
gh api user/starred --paginate --jq -r '.[] | [.full_name, (.stargazers_count|tostring), (.language // "â€”"), .html_url] | @tsv' |
while IFS=$'\t' read -r repo stars lang url || [[ -n "${repo:-}" ]]; do
  printf "%-40.40s %-8s %-15.15s %s\n" "$repo" "$stars" "$lang" "$url"
done
